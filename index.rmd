Practical ML: Course Project by Eric Farr
========================================================

Explore the Data
----------------

Load libraries and set seed for repeatable results.
```{r}
options(warn=-1)
library(randomForest)
library(caret)
library(corrplot)
library(ggplot2)
set.seed(101)
```
Load data.

```{r}
pml <- read.csv("pml-training.csv")
pml_test <- read.csv("pml-testing.csv")
```

Eliminate columns that are sparsely populated (and not populated in the test data)
```{r}
goodCols <- names(pml_test[,colSums(is.na(pml_test)) == 0])
pml_test <- pml_test[,goodCols]
pml <- pml[,c(which(names(pml) %in% goodCols),160)]
```

Eliminate columns that are clearly not meaningful
```{r}
pml <- pml[,- grep("user_name|X|timestamp|window", names(pml))]
```

Split into 70% training and 30% validation.

```{r}
inTrain <- createDataPartition(y = pml$classe, p = .70, list=FALSE)
training <- pml[inTrain,]
testing <- pml[-inTrain,]
```

Do we have any remaining variables that don't add something?

```{r}
nearZeroVar(training, saveMetrics=FALSE)
```

Do we have any highly correlated variables?

```{r fig.width=10, fig.height=10}
class <- which(names(training) == "classe")
correlationMatrix <- cor(training[,-class])
diag(correlationMatrix) <- 0
corrplot(correlationMatrix, order = "FPC", method = "color", type = "lower", tl.cex = 0.8, tl.col = rgb(0, 0, 0))
```

The correlation plot shows quite a few highly correlated factors (some positively and some negatively). Instead of manually pulling out redundant variables, we'll make use of principle components analysis to synthesize meaningful variables by combining correlated variables appropriately.

```{r}
preProc <- preProcess(training[,-class], method = "pca", thresh=0.97)
trainPC <- predict(preProc, training[,-class])
modelFit <- randomForest(training$classe ~ ., data=trainPC)

testPC <- predict(preProc, testing[,-class])
confusionMatrix(testing$classe, predict(modelFit,testPC))
```

Model fit without using PCA.

```{r}
modelFit <- randomForest(training$classe ~ ., data=training, importance = TRUE)
confusionMatrix(testing$classe, predict(modelFit,testing[,-class]))
```

Importance of variables:

```{r}
importance <- data.frame(modelFit$importance)
importance[order(-importance$MeanDecreaseAccuracy),]
```

